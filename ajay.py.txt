<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zella Pro Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #09090b; --card: #18181b; --border: #27272a; --accent: #a78bfa; }
        body { background-color: var(--bg); color: #ececec; font-family: 'Segoe UI', Roboto, sans-serif; }
        .zella-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; }
        .stat-label { color: #71717a; font-size: 0.75rem; text-transform: uppercase; font-weight: 600; }
        input, select, textarea { background: #27272a !important; border: 1px solid #3f3f46 !important; color: white; padding: 10px; border-radius: 8px; width: 100%; margin-bottom: 12px; }
        .btn-primary { background: var(--accent); color: black; font-weight: bold; padding: 12px; border-radius: 8px; width: 100%; transition: 0.2s; }
        .tab-active { color: var(--accent); border-bottom: 2px solid var(--accent); }
    </style>
</head>
<body class="pb-24">

    <div class="p-6 flex justify-between items-center border-b border-gray-800 sticky top-0 bg-black z-50">
        <h1 class="text-xl font-bold tracking-tight">Dashboard <span class="text-purple-500">.</span></h1>
        <button onclick="toggleForm()" class="bg-white text-black px-4 py-1 rounded-full text-sm font-bold">+ New Trade</button>
    </div>

    <div id="main-content" class="p-4">
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="zella-card p-4">
                <p class="stat-label">Net P&L</p>
                <p id="netPl" class="text-2xl font-bold text-green-400">$0.00</p>
            </div>
            <div class="zella-card p-4">
                <p class="stat-label">Avg R-Multiple</p>
                <p id="avgR" class="text-2xl font-bold text-blue-400">0.0R</p>
            </div>
        </div>

        <div class="zella-card p-4 mb-6">
            <p class="stat-label mb-4">Equity Curve</p>
            <canvas id="equityChart" height="180"></canvas>
        </div>

        <h2 class="font-bold mb-4 ml-1">Recent Executions</h2>
        <div id="tradeContainer" class="space-y-3">
            </div>
    </div>

    <div id="tradeModal" class="fixed inset-0 bg-black p-6 z-[100] hidden overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Log execution</h2>
            <button onclick="toggleForm()" class="text-gray-400">Close</button>
        </div>
        
        <label class="text-xs font-bold text-gray-400">Symbol & Setup</label>
        <input type="text" id="symbol" placeholder="e.g. NVDA or EURUSD">
        <select id="setup">
            <option value="Breakout">Breakout</option>
            <option value="Mean Reversion">Mean Reversion</option>
            <option value="Gap Fill">Gap Fill</option>
        </select>

        <label class="text-xs font-bold text-gray-400">Trade Logic ($)</label>
        <div class="grid grid-cols-2 gap-2">
            <input type="number" id="entry" placeholder="Entry Price">
            <input type="number" id="exit" placeholder="Exit Price">
            <input type="number" id="stop" placeholder="Stop Loss">
            <input type="number" id="size" placeholder="Quantity/Size">
        </div>

        <label class="text-xs font-bold text-gray-400">Screenshot</label>
        <input type="file" id="imageInput" accept="image/*" class="text-sm">
        
        <button onclick="saveTrade()" class="btn-primary mt-4">Save Execution</button>
    </div>

    <div class="fixed bottom-0 w-full bg-black border-t border-gray-800 flex justify-around p-4 text-[10px] uppercase font-bold tracking-widest text-gray-500">
        <div class="tab-active text-center">üìä<br>Dash</div>
        <div class="text-center">üìì<br>Notes</div>
        <div class="text-center">üéØ<br>Playbook</div>
        <div class="text-center">‚öôÔ∏è<br>Settings</div>
    </div>

    <script>
        let trades = JSON.parse(localStorage.getItem('zellaTrades')) || [];
        let chart;

        function toggleForm() {
            const modal = document.getElementById('tradeModal');
            modal.classList.toggle('hidden');
        }

        function saveTrade() {
            const entry = parseFloat(document.getElementById('entry').value);
            const exit = parseFloat(document.getElementById('exit').value);
            const stop = parseFloat(document.getElementById('stop').value);
            const size = parseFloat(document.getElementById('size').value);
            const symbol = document.getElementById('symbol').value;
            const setup = document.getElementById('setup').value;
            const fileInput = document.getElementById('imageInput');

            // Math Logic
            const pnl = (exit - entry) * size;
            const riskPerShare = Math.abs(entry - stop);
            const rMultiple = riskPerShare !== 0 ? (pnl / (riskPerShare * size)).toFixed(2) : 0;

            const reader = new FileReader();
            reader.onload = function(e) {
                const trade = {
                    symbol, setup, pnl, rMultiple, 
                    img: e.target.result, 
                    date: new Date().toLocaleDateString()
                };
                trades.unshift(trade);
                localStorage.setItem('zellaTrades', JSON.stringify(trades));
                toggleForm();
                render();
            };

            if (fileInput.files[0]) {
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                reader.onload({ target: { result: null } });
            }
        }

        function render() {
            const container = document.getElementById('tradeContainer');
            container.innerHTML = '';
            let totalPnl = 0;
            let totalR = 0;
            let chartPoints = [0];

            trades.forEach(t => {
                totalPnl += t.pnl;
                totalR += parseFloat(t.rMultiple);
                chartPoints.push(totalPnl);

                container.innerHTML += `
                    <div class="zella-card p-4 flex flex-col gap-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-lg">${t.symbol}</h3>
                                <span class="bg-gray-800 text-[10px] px-2 py-1 rounded text-gray-400 uppercase">${t.setup}</span>
                            </div>
                            <div class="text-right">
                                <p class="${t.pnl >= 0 ? 'text-green-400' : 'text-red-400'} font-bold">$${t.pnl.toFixed(2)}</p>
                                <p class="text-xs text-blue-400">${t.rMultiple}R</p>
                            </div>
                        </div>
                        ${t.img ? <img src="${t.img}" class="rounded-lg border border-gray-700 w-full h-32 object-cover"> : ''}
                    </div>
                `;
            });

            document.getElementById('netPl').innerText = $${totalPnl.toFixed(2)};
            document.getElementById('netPl').className = text-2xl font-bold ${totalPnl >= 0 ? 'text-green-400' : 'text-red-400'};
            document.getElementById('avgR').innerText = ${(totalR / (trades.length || 1)).toFixed(1)}R;

            renderChart(chartPoints);
        }

        function renderChart(dataPoints) {
            const ctx = document.getElementById('equityChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dataPoints.map((_, i) => i),
                    datasets: [{
                        data: dataPoints,
                        borderColor: '#a78bfa',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: 'rgba(167, 139, 250, 0.05)'
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: '#27272a' } } } }
            });
        }

        render();
    </script>
</body>
</html>